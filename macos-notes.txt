
# HOMEBREW CONFIG

export HOMEBREW_NO_AUTO_UPDATE=1
# Set Homebrew temporary folders
export HOMEBREW_TEMP=$HOME/goinfre/Homebrew/Temp
export HOMEBREW_CACHE=$HOME/goinfre/Homebrew/Temp/Caches

mkdir -p $HOMEBREW_CACHE
mkdir -p $HOMEBREW_TEMP

# If NFS session
# Symlink Locks folder in /tmp
if df -T autofs,nfs $HOME 1>/dev/null
then
  HOMEBREW_LOCKS_TARGET=$HOME/goinfre/.Homebrew/Temp/Locks
  HOMEBREW_LOCKS_FOLDER=$BREW/var/homebrew

  mkdir -p $HOMEBREW_LOCKS_TARGET
  mkdir -p $HOMEBREW_LOCKS_FOLDER

  # Symlink to Locks target folders
  # If not already a symlink
  if ! [[ -L $HOMEBREW_LOCKS_FOLDER && -d $HOMEBREW_LOCKS_FOLDER ]]
  then
     echo "Creating symlink for Locks folder"
     rm -rf $HOMEBREW_LOCKS_FOLDER
     ln -s $HOMEBREW_LOCKS_TARGET $HOMEBREW_LOCKS_FOLDER
  fi
fi



# MacOS Specific config
if [[ "$OSTYPE" == "darwin"* ]]; then
    BREW=$HOME/goinfre/mybrew
    BREW_BIN=$BREW/bin
    # source "$HOME"/.brew_packages.zsh
    # source "$HOME"/.brewconfig.zsh
    # Turns 'press & hold OS X' false for VSCode
    defaults write com.microsoft.VSCode ApplePressAndHoldEnabled -bool false
    # Prints available space
    # df -H | grep "$HOME" | awk "{printf('\t\t\t\t\tAvailable %s\t\n\'), $4}"
    PATH=$PATH:/usr/local/munki:/Library/Apple/usr/bin
    PATH=$PATH:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin
    PATH=$PATH:$BREW:$BREW_BIN
    PATH=$PATH:"/opt/goinfre/posidoni/mybrew/opt/ccache/libexec":"/Volumes/MISHA/nvim-macos/bin"
    # Os X specific aliases
    alias flash="cd /Volumes/MISHA"
    export PATH="/opt/goinfre/posidoni/mybrew/opt/llvm/bin:$PATH" # adds LLVM toolkit to PATH
fi;



if [ -d "$HOME/Applications" ] ;
  then PATH="$HOME/Applications:$PATH"
fi



# Asynchronously installs code plugins (spawns zsh instance for each extension)
install_code() {
    for plugin in ${code_plugins[@]}; do
        ( code --install-extension "$plugin" > /dev/null & )
    done
}

dump_brew() {
    brew list > "$HOME/myrc/configs/.brew_plugins_dump.txt"
}


restart_dock() {
    defaults delete com.apple.dock; killall Dock
}

reset_dock() {
    rm ~/Library/Preferences/com.apple.dock.plist
    rm ~/Library/Caches/com.apple.finder/Cache.db
}
